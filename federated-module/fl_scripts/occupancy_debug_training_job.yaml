apiVersion: batch/v1
kind: Job
metadata:
  name: federated-training-occupancy-worker-test123
  namespace: kafkaml
spec:
  ttlSecondsAfterFinished: 100
  template:
    spec:
      containers:
      - image: host.docker.internal:50000/federated_model_training_tensorflow:latest
        name: training
        env:
        - name: KML_CLOUD_BOOTSTRAP_SERVERS
          value: kafka:9092
        - name: DATA_BOOTSTRAP_SERVERS
          value: kafka:9092
        - name: DATA_TOPIC
          value: FED-OCCUPANCY-data_topic
        - name: UNSUPERVISED_TOPIC
          value: ""
        - name: INPUT_FORMAT
          value: RAW
        - name: INPUT_CONFIG
          value: '{"type": "float32", "data_type": "float32", "data_reshape": "5", "label_type": "float32", "label_reshape": "1"}'
        - name: VALIDATION_RATE
          value: "0.1"
        - name: TEST_RATE
          value: "0.1"
        - name: TOTAL_MSG
          value: "500"
        - name: FEDERATED_MODEL_ID
          value: dk18b68b
        - name: FEDERATED_CLIENT_ID
          value: occupancy_client_001
        - name: NVIDIA_VISIBLE_DEVICES
          value: "all"
        - name: CASE
          value: "5"
        - name: ETH_RPC_URL
          value: "http://blockchain:8545"
        - name: ETH_CONTRACT_ADDRESS
          value: "0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512"
        - name: ETH_CONTRACT_ABI
          value: '[{"inputs": [], "stateMutability": "nonpayable", "type": "constructor"}, {"anonymous": false, "inputs": [{"indexed": false, "internalType": "address", "name": "client", "type": "address"}, {"indexed": false, "internalType": "string", "name": "model", "type": "string"}, {"indexed": false, "internalType": "string", "name": "metrics", "type": "string"}], "name": "add_update_to_queue", "type": "event"}, {"anonymous": false, "inputs": [{"indexed": false, "internalType": "string", "name": "value", "type": "string"}, {"indexed": false, "internalType": "uint256", "name": "round", "type": "uint256"}], "name": "dequeue_model_update", "type": "event"}, {"anonymous": false, "inputs": [{"indexed": false, "internalType": "string", "name": "globalModel", "type": "string"}, {"indexed": false, "internalType": "string", "name": "kafkaModel", "type": "string"}], "name": "global_update_relationship", "type": "event"}, {"anonymous": false, "inputs": [{"indexed": false, "internalType": "uint256", "name": "round", "type": "uint256"}, {"indexed": false, "internalType": "string", "name": "model", "type": "string"}], "name": "set_global_model", "type": "event"}, {"anonymous": false, "inputs": [{"indexed": false, "internalType": "string", "name": "kafkaModel", "type": "string"}, {"indexed": false, "internalType": "uint256", "name": "tokens", "type": "uint256"}], "name": "set_tokens_to_update", "type": "event"}, {"inputs": [{"internalType": "address", "name": "_address", "type": "address"}], "name": "countTokens", "outputs": [{"internalType": "uint256", "name": "count", "type": "uint256"}], "stateMutability": "view", "type": "function"}, {"inputs": [], "name": "dequeueModel", "outputs": [], "stateMutability": "nonpayable", "type": "function"}, {"inputs": [], "name": "evaluator", "outputs": [{"internalType": "address", "name": "", "type": "address"}], "stateMutability": "view", "type": "function"}, {"inputs": [], "name": "getCurrentRound", "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}], "stateMutability": "view", "type": "function"}, {"inputs": [{"internalType": "uint256", "name": "_round", "type": "uint256"}], "name": "getGlobalModel", "outputs": [{"internalType": "string", "name": "", "type": "string"}], "stateMutability": "view", "type": "function"}, {"inputs": [{"internalType": "string", "name": "globalModel", "type": "string"}], "name": "getGlobalModelToUpdate", "outputs": [{"internalType": "string", "name": "", "type": "string"}], "stateMutability": "view", "type": "function"}, {"inputs": [{"internalType": "uint256", "name": "round", "type": "uint256"}], "name": "getMetricsByRound", "outputs": [{"internalType": "string", "name": "", "type": "string"}], "stateMutability": "view", "type": "function"}, {"inputs": [{"internalType": "string", "name": "model", "type": "string"}], "name": "getModelAccount", "outputs": [{"internalType": "address", "name": "", "type": "address"}], "stateMutability": "view", "type": "function"}, {"inputs": [], "name": "getModelArchitecture", "outputs": [{"internalType": "string", "name": "", "type": "string"}], "stateMutability": "view", "type": "function"}, {"inputs": [], "name": "getModelCompileArgs", "outputs": [{"internalType": "string", "name": "", "type": "string"}], "stateMutability": "view", "type": "function"}, {"inputs": [{"internalType": "string", "name": "model", "type": "string"}], "name": "getModelDataSize", "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}], "stateMutability": "view", "type": "function"}, {"inputs": [{"internalType": "string", "name": "model", "type": "string"}], "name": "getModelMetrics", "outputs": [{"internalType": "string", "name": "", "type": "string"}], "stateMutability": "view", "type": "function"}, {"inputs": [], "name": "getParticipants", "outputs": [{"internalType": "address[]", "name": "", "type": "address[]"}], "stateMutability": "view", "type": "function"}, {"inputs": [], "name": "getQueueFirstElement", "outputs": [{"internalType": "string", "name": "", "type": "string"}], "stateMutability": "view", "type": "function"}, {"inputs": [{"internalType": "address", "name": "_address", "type": "address"}], "name": "getReward", "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}], "stateMutability": "view", "type": "function"}, {"inputs": [], "name": "getSize", "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}], "stateMutability": "view", "type": "function"}, {"inputs": [], "name": "getStartTrainingTimestamp", "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}], "stateMutability": "view", "type": "function"}, {"inputs": [], "name": "getStopTrainingTimestamp", "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}], "stateMutability": "view", "type": "function"}, {"inputs": [], "name": "getTrainingSettings", "outputs": [{"internalType": "string", "name": "", "type": "string"}], "stateMutability": "view", "type": "function"}, {"inputs": [], "name": "getTrainingStatus", "outputs": [{"internalType": "bool", "name": "", "type": "bool"}], "stateMutability": "view", "type": "function"}, {"inputs": [{"internalType": "string", "name": "kafkaModel", "type": "string"}, {"internalType": "uint256", "name": "_round", "type": "uint256"}], "name": "saveGlobalModel", "outputs": [], "stateMutability": "nonpayable", "type": "function"}, {"inputs": [{"internalType": "string", "name": "kafkaModel", "type": "string"}, {"internalType": "string", "name": "globalModel", "type": "string"}], "name": "saveGlobalModelToUpdate", "outputs": [], "stateMutability": "nonpayable", "type": "function"}, {"inputs": [{"internalType": "string", "name": "_trainingSettings", "type": "string"}, {"internalType": "string", "name": "_modelArchitecture", "type": "string"}, {"internalType": "string", "name": "_modelCompileArgs", "type": "string"}], "name": "saveTrainingSettings", "outputs": [], "stateMutability": "nonpayable", "type": "function"}, {"inputs": [{"internalType": "string", "name": "kafkaModel", "type": "string"}, {"internalType": "string", "name": "metrics", "type": "string"}, {"internalType": "uint256", "name": "data_amount", "type": "uint256"}], "name": "sendClientContribution", "outputs": [], "stateMutability": "nonpayable", "type": "function"}, {"inputs": [{"internalType": "string", "name": "kafkaModel", "type": "string"}, {"internalType": "uint256", "name": "_numTokens", "type": "uint256"}], "name": "setTokens", "outputs": [], "stateMutability": "nonpayable", "type": "function"}, {"inputs": [], "name": "stopTraining", "outputs": [], "stateMutability": "nonpayable", "type": "function"}]'
        - name: ETH_WALLET_ADDRESS
          value: "0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266"
        - name: ETH_WALLET_KEY
          value: "0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80"
        imagePullPolicy: Always
      restartPolicy: OnFailure
  backoffLimit: 1
